

@goal soft_folder_created
@reached_if [[ -d "soft" ]]
  mkdir soft

@goal tush_installed
@depends_on soft_folder_created
@reached_if [[ -f "soft/tush/bin/tush-check" ]]
  echo
  echo "Fetching tush..."
  echo

  cd "soft"

  wget https://github.com/adolfopa/tush/archive/master.zip -O./tush.zip
  unzip ./tush.zip
  rm ./tush.zip
  mv tush-master tush

@goal soft_installed
@depends_on tush_installed

@goal cleaned

@goal cleaned_soft
@reached_if [[ ! -d "soft" ]]
  rm -r "soft"

@goal cleaned_all
@depends_on cleaned cleaned_soft

@goal tested
@depends_on tests_executed

@goal tests_executed
@depends_on tush_installed
  export PATH="$PATH:$MYDIR/soft/tush/bin"

  for f in tests/*.tush
  do
    tush-check "$f" && echo "TESTS PASSED : $f" || (
      echo "!!! TESTS FAILED !!! : $f"
      exit 1
    )
  done

@goal default
@depends_on tested
